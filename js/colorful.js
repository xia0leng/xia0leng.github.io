var config = {
    readme: {
		start: true,
        name: 'æ¬¢è¿ Welcome',
        type: 'md',
        value: 'readme',
		urlPath: '/',
        style: ['medium'],
        link: ['entry', 'icon'],
        icon: 'help'
    },
	event05: {
        name: 'é€šçŸ¥ Notice',
        type: 'md',
        value: 'event05',
		urlPath: '/',
		style: ['ultrasmall'],
    },
	photos: {
        name: 'ç…§ç‰‡ Photos',
        type: 'folder',
		icon:'photos',
        value: {
			DKFLBivUdQ: {
                name: 'DKFL-BivUdQ',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid04EKaL2mssTNjAmniRhHRQ2fG1HvRDv6n8umwAHNvZW1vfKjUkAhE9HEwg5bsSpXMl&show_text=true',
                style: ['large']
            },
			DJvZVaBIbKD: {
                name: 'DJvZVaBIbKD',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid02S967B3yGwmP99q3KbT38X9XUhMYixZ8UBa2sNRXsVzdeEeWhN9FcrRTjmKWaxzTql&show_text=true',
                style: ['large']
            },
            DJe7EsKv8Ft: {
                name: 'DJe7EsKv8Ft',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid0Y6qcAH1VSmjXbta3bo9Seyy9z6Upe9brqXMznhHAi73FJFdZvhggcmDfHnMmBfLXl&show_text=true',
                style: ['large']
            },
			DH0HZ8Nvc0p: {
                name: 'DH0HZ8Nvc0p',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid02ButQG3qn33gtLZitJABxiYx4oKuRsBUqfTQmfQnDymBKZRQnD5XX5B9i8ihXCoaKl&show_text=true',
                style: ['large']
            },
			DB5h7o7IqJp: {
                name: 'DB5h7o7IqJp',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid02VjtTDg2qzwXt8ABa4h7qZbF6kzepGGEv8KJFDv5ZQRw3Jo13ne2p3WVYq8cv9n6pl&show_text=true',
                style: ['large']
            },
			C8oplrDBj5N: {
                name: 'C8oplrDBj5N',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid0j3Zu2BXd8bJmLggVciM8h2VPjQn5Cw82TBSvGTH9isQCdnezQnGDmBHmwPDGv3TXl&show_text=true',
                style: ['large']
            },
			DArqX9LmCe: {
                name: 'DArqX9LmCe',
                type: 'iframe',
				icon:'img',
                value: 'https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fxlnww%2Fposts%2Fpfbid0oXPa2Sg5Ytnp7r4pU73q6YJmYGPScoURecVX3hxotqD25hfbk3FHYAkcNJmbiuWjl&show_text=true',
                style: ['large']
            },
			instagram: {
				name: 'æ¥insçœ‹å›¾å–µ Ins',
				title: 'Instagram',
				type: 'js',
				icon:'instagram',
				value: 'instagram.js',
				urlPath: '/instagram',
				external: true,
				style: ['ultrasmall']
			},
        },
        desc: 'è¿™é‡Œæ±‡èšäº†å°å†·çš„æ‰€æœ‰é—ªè€€ç¬é—´ï¼šèˆå°é—ªå…‰ã€æ—¥å¸¸èŒæ‹ã€å¶å°”æµéœ²çš„ç—…å¨‡å°è¡¨æƒ…<br> All my shining momentsâ€”stage highlights, everyday cuteness, and the occasional yandere glance.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
	stagevideos: {
        name: 'èˆå°å½•åƒ Stage Videos',
        type: 'folder',
		icon:'stage',
        value: {
			DKFLBivUdQ: {
                name: '#ã‚ãã‚è‰²ã±ã‚Œã£ã¨',
                type: 'url',
				icon:'videos',
                value: './fw/stagevideos/05.html',
                style: ['large']
            },
			DJvZVaBIbKD: {
                name: 'CHASE!',
                type: 'url',
				icon:'videos',
                value: './fw/stagevideos/04.html',
                style: ['large']
            },
			DB5h7o7IqJp: {
                name: 'Tiny Stars',
                type: 'url',
				icon:'videos',
                value: './fw/stagevideos/01.html',
                style: ['large']
            },
			bilibili: {
				name: 'æ¥bç«™å¬å”±æ­Œå–µ bili',
				title: 'å“”å“©å“”å“© Bilibili',
        		type: 'js',
				icon:'bilibili',
        		value: 'bilibili.js',
				urlPath: '/bilibili',
				external: true,
				style: ['ultrasmall']
			},
			youtube: {
				name: 'å»ytçœ‹èˆå°å–µ YT',
				title: 'YouTube',
        		type: 'js',
				icon:'youtube',
        		value: 'youtube.js',
				urlPath: '/youtube',
				external: true,
				style: ['ultrasmall']
    		},
        },
        desc: 'è¿™é‡Œæ”¶è—äº†å°å†·åœ¨èˆå°ä¸Šæœ€é—ªäº®çš„ç¬é—´<br> Here my brightest magical moments on stage.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
    medication: {
        name: 'è¯ç‰© Medication',
        type: 'okusuri',
        value: {
			Drugs: {
                name: 'è¯ç‰©åˆ—è¡¨ Drugs',
                type: 'folder',
				icon:'okusurifolder',
                value: {
            		DXM: {
                		name: 'å³ç¾æ²™èŠ¬',
                		type: '123',
                		value: './fw/drugs/DXM.html',
						urlPath: '/Drugs/DXM',
                		style: ['large']
            		},
            		The_harm_of_dextromethorphan: {
						name: 'å³ç¾æ²™èŠ¬çš„å±å®³ä¸“é¢˜',
						type: '123',
						value: './fw/drugs/The_harm_of_dextromethorphan.html',
						style: ['large']
					},
					ATD: {
						name: 'é‡‘åˆšçƒ·èƒº',
						type: '123',
						value: './fw/drugs/ATD.html',
						style: ['large']
					},
					PR: {
						name: 'æ™®ç‘å·´æ—',
						type: '123',
						value: './fw/drugs/PR.html',
						style: ['large']
					},
					CDI: {
						name: 'å¯å¾…å› ',
						type: '123',
						value: './fw/drugs/CDI.html',
						style: ['large']
					},
					DHCDI: {
						name: 'äºŒæ°¢å¯å¾…å› /ç™½å…”BRONå…¶ä¸€',
						type: '123',
						value: './fw/drugs/DHCDI.html',
						style: ['large']
					},
					MMT: {
						name: 'ç¾é‡‘åˆš',
						type: '123',
						value: './fw/drugs/MMT.html',
						style: ['large']
					},
					TMD: {
						name: 'æ›²é©¬å¤š',
						type: '123',
						value: './fw/drugs/TMD.html',
						style: ['large']
					},
					ZD: {
						name: 'Zè¯ç‰©',
						type: '123',
						value: './fw/drugs/ZD.html',
						style: ['large']
					},
					BZD: {
						name: 'è‹¯äºŒæ°®å“ç±»è¯ç‰©',
						type: '123',
						value: './fw/drugs/BZD.html',
						style: ['large']
					},
					Opioids: {
						name: 'é˜¿ç‰‡ç±»è¯ç‰©',
						type: '123',
						value: './fw/drugs/Opioids.html',
						style: ['large']
					},
					RTL: {
						name: 'å“Œé†‹ç”²é…¯',
						type: '123',
						value: './fw/drugs/RTL.html',
						style: ['large']
					},
					KTM: {
						name: 'æ°¯èƒºé…®',
						type: '123',
						value: './fw/drugs/KTM.html',
						style: ['large']
					},
					EtOH: {
						name: 'ä¹™é†‡',
						type: '123',
						value: './fw/drugs/EtOH.html',
						style: ['large']
					},
					Cigarette: {
						name: 'é¦™çƒŸ',
						type: '123',
						value: './fw/drugs/Cigarette.html',
						style: ['large']
					},
					ACL: {
						name: 'æ§Ÿæ¦”ç¢±',
						type: '123',
						value: './fw/drugs/ACL.html',
						style: ['large']
					},
					SRIs: {
						name: 'è¡€æ¸…ç´ å†æ‘„å–æŠ‘åˆ¶å‰‚',
						type: '123',
						value: './fw/drugs/SRIs.html',
						style: ['large']
					},
					AES: {
						name: 'æ­¢åè¯',
						type: '123',
						value: './fw/drugs/AES.html',
						style: ['large']
					},
					VPA: {
						name: 'ä¸™æˆŠé…¸',
						type: '123',
						value: './fw/drugs/VPA.html',
						style: ['large']
					},
					NFP: {
						name: 'å¥ˆç¦æ³®',
						type: '123',
						value: './fw/drugs/NFP.html',
						style: ['large']
					},
					DPX: {
						name: 'åœ°èŠ¬è¯ºé…¯',
						type: '123',
						value: './fw/drugs/DPX.html',
						style: ['large']
					},
					QTP: {
						name: 'å–¹ç¡«å¹³',
						type: '123',
						value: './fw/drugs/QTP.html',
						style: ['large']
					},
					RPD: {
						name: 'åˆ©åŸ¹é…®',
						type: '123',
						value: './fw/drugs/RPD.html',
						style: ['large']
					},
					DMH: {
						name: 'èŒ¶è‹¯æµ·æ˜',
						type: '123',
						value: './fw/drugs/DMH.html',
						style: ['large']
					},
					PVR: {
						name: 'å–·æ‰˜ç»´æ—',
						type: '123',
						value: './fw/drugs/PVR.html',
						style: ['large']
					},
					THP: {
						name: 'è‹¯æµ·ç´¢',
						type: '123',
						value: './fw/drugs/THP.html',
						style: ['large']
					},
					EI: {
						name: 'é…¶æŠ‘åˆ¶å‰‚',
						type: '123',
						value: './fw/drugs/EI.html',
						style: ['large']
					},
					SPM: {
						name: 'è¡¥å……å‰‚',
						type: '123',
						value: './fw/drugs/SPM.html',
						style: ['large']
					},
					CFI: {
						name: 'å’–å•¡å› ',
						type: '123',
						value: './fw/drugs/CFI.html',
						style: ['large']
					},
					TAN: {
						name: 'èŒ¶æ°¨é…¸',
						type: '123',
						value: './fw/drugs/TAN.html',
						style: ['large']
					},
					MGT: {
						name: 'è‹ç³–é…¸é•',
						type: '123',
						value: './fw/drugs/MGT.html',
						style: ['large']
					},
					PCT: {
						name: 'å¡æ‹‰è¥¿å¦',
						type: '123',
						value: './fw/drugs/PCT.html',
						style: ['large']
					},
					MOP: {
						name: 'å—å•¡',
						type: '123',
						value: './fw/drugs/MOP.html',
						style: ['large']
					},
					GBP: {
						name: 'åŠ å·´å–·ä¸',
						type: '123',
						value: './fw/drugs/GBP.html',
						style: ['large']
					},
					BCF: {
						name: 'å·´æ°¯èŠ¬',
						type: '123',
						value: './fw/drugs/BCF.html',
						style: ['large']
					},
					PPF: {
						name: 'ä¸™æ³Šé…š',
						type: '123',
						value: './fw/drugs/PPF.html',
						style: ['large']
					},
					ZPD: {
						name: 'å”‘å¡å¦',
						type: '123',
						value: './fw/drugs/ZPD.html',
						style: ['large']
					},
					ZPO: {
						name: 'æ‰æ¥æ™®éš†',
						type: '123',
						value: './fw/drugs/ZPO.html',
						style: ['large']
					},
					ZPC: {
						name: 'ä½åŒ¹å…‹éš†',
						type: '123',
						value: './fw/drugs/ZPC.html',
						style: ['large']
					},
					DPD: {
						name: 'åœ°èŠ¬å°¼å¤š',
						type: '123',
						value: './fw/drugs/DPD.html',
						style: ['large']
					},
					PMZ: {
						name: 'å¼‚ä¸™å—ª',
						type: '123',
						value: './fw/drugs/PMZ.html',
						style: ['large']
					},
					TXT: {
						name: 'æ‰˜è«è¥¿æ±€',
						type: '123',
						value: './fw/drugs/TXT.html',
						style: ['large']
					},
					OZP: {
						name: 'å¥¥æ°®å¹³',
						type: '123',
						value: './fw/drugs/OZP.html',
						style: ['large']
					},
					ARP: {
						name: 'é˜¿ç«‹å“Œå”‘',
						type: '123',
						value: './fw/drugs/ARP.html',
						style: ['large']
					},
					ASP: {
						name: 'æ°¨ç£ºå¿…åˆ©',
						type: '123',
						value: './fw/drugs/ASP.html',
						style: ['large']
					},
					compound: {
						name: 'å¤æ–¹ä¸“é¢˜',
						type: '123',
						value: './fw/drugs/compound.html',
						style: ['large']
					},
					DPH: {
						name: 'è‹¯æµ·æ‹‰æ˜',
						type: '123',
						value: './fw/drugs/DPH.html',
						style: ['large']
					},
				},
				urlPath: '/Drugs',
				style: ['medium']
			},
			Effects: {
                name: 'è¯ç‰©æ•ˆæœ Effects',
                type: 'folder',
				icon:'okusurifolder',
                value: {
                    Dissociation: {
						name: 'è§£ç¦»',
						type: 'md2',
						value: './fw/effects/Dissociation.html',
						style: ['large']
					},
					Antidissociation: {
						name: 'åè§£ç¦»',
						type: 'md2',
						value: './fw/effects/Antidissociation.html',
						style: ['large']
					},
					Delirium: {
						name: 'è°µå¦„',
						type: 'md2',
						value: './fw/effects/Delirium.html',
						style: ['large']
					},
					Introduction_to_Hallucination: {
						name: 'å¹»è§‰ç®€è¿°',
						type: 'md2',
						value: './fw/effects/Introduction_to_Hallucination.html',
						style: ['large']
					},
					Opioids: {
						name: 'é˜¿ç‰‡ç±»éº»é†‰',
						type: 'md2',
						value: './fw/drugs/Opioids.html',
						style: ['large']
					},
					BZD: {
						name: 'è‹¯äºŒæ°®å“ç±»',
						type: 'md2',
						value: './fw/drugs/BZD.html',
						style: ['large']
					},
					SRIs: {
						name: 'è¡€æ¸…ç´ å†æ‘„å–æŠ‘åˆ¶SRI',
						type: 'md2',
						value: './fw/drugs/SRIs.html',
						style: ['large']
					},
                },
				urlPath: '/Effects',
				style: ['medium']
            },
			drugcombination: {
                name: 'è¯ç‰©è”ç”¨',
                type: 'md2',
                value: './fw/effects/Combination_drugs.html',
                style: ['large']
            },
			odw: {
                name: 'OverdoseWiki',
                type: 'js',
				icon:'odw',
                value: 'odw.js',
				external: true,
                style: ['ultrasmall']
            }
        },
        desc: 'è¿™æ˜¯å¯¹odwikiä¸Šæ‰€åˆ—å‡ºçš„æ‰€æœ‰è¯ç‰©è¯´æ˜çš„å¤‡ä»½å­˜æ¡£<br> This is a backup archive of all the drug descriptions listed on odwiki.<br> âš ï¸è¯·å‡å°‘odæ¬¡æ•°âš ï¸ä¹Ÿè¯·å®‰å…¨çš„ä½¿ç”¨è¯ç‰©<br> âš ï¸Please reduce the number of overdosesâš ï¸ and use drugs safely.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
    secret: {
        name: 'ç§˜å¯† Secret',
        type: 'folder',
        value: {
            secret2: {
                name: '[encrypted]',
                type: 'folder',
                value: {
                    secret3: {
                        name: '???',
                        type: 'folder',
                        value: {
                            'ç¸ºï½ªç¸ºï½«ç¹§ã‚…â†‘ç¸º': {}
                        }
                    }
                }
            }
        },
        link: ['entry']
    },
	articles: {
        name: 'æ–‡ç«  Articles',
        type: 'folder',
		icon:'articles',
        value: {
            1922157354659021001: {
                name: 'å¯¹è¯å°å†·ã€Œä»7ä¸‡åˆ° A7ï¼šç”¨é€»è¾‘å’Œæ•°æ®æ‰“é€ é«˜èƒœç‡çš„äº¤æ˜“ç³»ç»Ÿã€',
                type: 'md2',
                value: './articles/1922157354659021001.html',
				urlPath: '/articles/1922157354659021001',
                style: ['large']
            },
        },
        desc: 'å°å†·çš„æƒ³æ³•å’Œå¯¹ä½ çš„å–œæ¬¢éƒ½åœ¨è¿™é‡Œ<br> All of my thoughtsâ€”and my fondness for youâ€”are right here.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
	bitmex: {
        name: 'BitMEX',
        type: 'folder',
		icon:'bitmexxln',
        value: {
            tradepanel: {
                name: 'äº¤æ˜“é¢æ¿ Trade Panel',
                type: 'js',
				icon:'bitmex',
                value: 'bitmexapp.js',
				external: true,
                style: ['ultrasmall']
            },
			signup: {
                name: 'æ³¨å†Œ Sign Up',
                type: 'js',
				icon:'bitmex',
                value: 'bitmexsignup.js',
				external: true,
                style: ['ultrasmall']
            },
			bitmexchinese: {
                name: 'ä¸­æ–‡ CN Chat Group',
                type: 'js',
				icon:'telegram',
                value: 'bitmexchinese.js',
				external: true,
                style: ['ultrasmall']
            },
			authenticatorandroid: {
                name: 'Authenticator (Android)',
                type: 'js',
				icon:'authenticator',
                value: 'authenticatorandroid.js',
				external: true,
                style: ['ultrasmall']
            },
			authenticatorios: {
                name: 'Authenticator (iOS)',
                type: 'js',
				icon:'authenticator',
                value: 'authenticatorios.js',
				external: true,
                style: ['ultrasmall']
            },
        },
        desc: 'ä¸æ˜¯å°å†·æŒ£åˆ°é’±æœ€å¤šçš„äº¤æ˜“æ‰€ï¼Œä½†æ˜¯æ˜¯å°å†·æœ€å–œæ¬¢çš„äº¤æ˜“æ‰€<br> It&#39;s not the exchange where I made the most money, but it&#39;s my favorite.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
    liq: {
        name: 'Liqâ„¢',
        type: 'folder',
		icon:'liq',
        value: {
            llss: {
                name: 'LÂ²SÂ²',
                type: 'iframe',
				icon:'LÂ²SÂ²',
                value: './llss/index.html',
				urlPath: '/llss',
                style: ['large']
            },
        },
        desc: 'Liqâ„¢ Engineæ˜¯æˆ‘ä»¬çš„ä¸‹ä¸€ä»£æ•°å­—è´§å¸è¡ç”Ÿå“äº¤æ˜“å¼•æ“<br> Liqâ„¢ Engine is our next generation of cryptocurrency derivatives trading engine.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
	liyuu: {
        name: 'Liyuu',
        type: 'folder',
		icon:'liq',
        value: {
            llss: {
                name: 'LÂ²SÂ²',
                type: 'iframe',
				icon:'LÂ²SÂ²',
                value: './llss/index.html',
				urlPath: '/llss',
                style: ['large']
            },
        },
        desc: 'Liqâ„¢ Engineæ˜¯æˆ‘ä»¬çš„ä¸‹ä¸€ä»£æ•°å­—è´§å¸è¡ç”Ÿå“äº¤æ˜“å¼•æ“<br> Liqâ„¢ Engine is our next generation of cryptocurrency derivatives trading engine.',
        style: ['medium'],
    },
    support: {
        name: 'æ”¯æŒ Support',
        type: 'folder',
		icon:'support',
        value: {
            contact: {
                name: 'è”ç³» Contact',
                type: 'url',
				icon:'support',
                value: './contact.html',
				urlPath: '/contact',
                style: ['large']
            },
            pgp: {
                name: 'PGP Public Key Block',
                type: 'md2',
                value: './support/pgp.html',
                style: ['large']
            }
        },
        desc: 'éœ€è¦è”ç³»å°å†·çš„å›¢é˜Ÿå—ï¼Ÿæ— è®ºä½ æ˜¯é‡åˆ°é—®é¢˜è¿˜æ˜¯æœ‰ç–‘é—®ï¼Œæ— è®ºç®€å•æˆ–å¤æ‚ï¼Œæˆ‘ä»¬å§‹ç»ˆåœ¨è¿™é‡Œä¸ºä½ æä¾›å¸®åŠ©<br> Need to get in touch with Xiaoleng&#39;s team? Whether you&#39;re encountering an issue or have questions, simple or complex, we&#39;re always here to assist you.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
    legal: {
        name: 'æ³•å¾‹ Legal',
        type: 'folder',
		icon:'legal',
        value: {
            terms: {
                name: 'æ¡æ¬¾å’Œéšç§å£°æ˜ Terms &amp; Privacy Notice',
                type: 'md2',
                value: './terms.html',
				urlPath: '/terms',
                style: ['large']
            },
            dh: {
                name: 'æ•°æ®å¤„ç†è¦æ±‚ Data Handling Requirement',
                type: 'md2',
                value: './legal/data-handle.html',
				urlPath: '/legal/data-handle',
                style: ['large']
            }
        },
        desc: 'ä¸ä½ æœ€å¯çˆ±çš„å°å†·ä¹‹é—´çš„åè®®ï¼Œè‡´åŠ›äºä¿æŠ¤ç”¨æˆ·æƒåˆ©ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå¹¶æä¾›é€æ˜çš„æœåŠ¡è§„èŒƒ<br> Agreement between you and your cutest idol Xiaoleng, committed to protecting user rights, ensuring data security, and providing transparent service regulations.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
	radio: {
        name: 'å†·å–µå¹¿æ’­ Follow me',
        type: 'folder',
		icon:'radio',
        value: {
			x: {
				name: 'X',
				type: 'js',
				icon:'x',
				value: 'x.js',
				urlPath: '/x',
				external: true,
				style: ['ultrasmall']
			},
			telegram: {
				name: 'Telegram',
        		type: 'js',
				icon:'telegram',
        		value: 'telegram.js',
				urlPath: '/telegram',
				external: true,
				style: ['ultrasmall']
    		},
    		instagram: {
				name: 'Instagram',
				type: 'js',
				icon:'instagram',
				value: 'instagram.js',
				urlPath: '/instagram',
				external: true,
				style: ['ultrasmall']
			},
			threads: {
				name: 'Threads',
				type: 'js',
				icon:'threads',
				value: 'threads.js',
				urlPath: '/threads',
				external: true,
				style: ['ultrasmall']
    		},
    		bilibili: {
				name: 'å“”å“©å“”å“© Bilibili',
        		type: 'js',
				icon:'bilibili',
        		value: 'bilibili.js',
				urlPath: '/bilibili',
				external: true,
				style: ['ultrasmall']
			},
        },
		urlPath: 'follow-me',
        desc: 'æœ¬å°å°†ä¸å®šæœŸæ’­é€æ¥è‡ªå°å†·çš„ï¼š<br>è‡ªæ‹ã€ç…§ç‰‡ã€å¯¹ä½ ä»¬çš„å–œæ¬¢ï¼Œä»¥åŠæƒ…ç»ªç¢ç‰‡<br> This station will occasionally bring you broadcasts from Xiaoleng:<br>selfies, photos, my affection for you, and fragments of emotion.',
        style: ['medium'],
        link: ['entry', 'icon']
    },
	install: {
		name: 'å®‰è£… Install',
    	type: 'js',
    	icon: 'install',
    	value: 'install.js',
		link: ['entry', 'icon'],
    	style: ['install']
	},
	passwords: {
		name: 'Passwords Backup',
    	type: 'iframe',
    	icon: '',
    	value: './passwords/index.html',
		urlPath: '/passwords',
    	style: ['large']
	},
	browserling: {
		name: 'Browserling',
    	type: 'iframe',
    	icon: '',
    	value: 'https://www.browserling.com',
		urlPath: '/browserling',
    	style: ['large']
	},
	notice: {
        name: 'é€šçŸ¥ Notice',
        type: 'md',
        value: 'notice',
		urlPath: '/',
		style: ['ultrasmall']
    },
	ddos: {
        name: 'ç«™ç‚¹çŠ¶æ€å…¬å‘Š Service Status Notice',
        type: 'md',
        value: 'ddos',
		urlPath: '/',
		style: ['small']
    },
	emotional01: {
        name: 'è­¦å‘Š Alert',
        type: 'md',
        value: 'emotional01',
		urlPath: '/',
		style: ['ultrasmall'],
    },
	emotional02: {
        name: 'è­¦å‘Š Alert',
        type: 'md',
        value: 'emotional02',
		urlPath: '/',
		style: ['ultrasmall'],
    },
	emotional03: {
        name: 'è­¦å‘Š Alert',
        type: 'md',
        value: 'emotional03',
		urlPath: '/',
		style: ['ultrasmall'],
    }
};

// å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ :has é€‰æ‹©å™¨ï¼Œè¯´æ˜æ˜¯æ—§ç‰ˆï¼ˆä¾‹å¦‚ Chrome 107ã€Safari 15 ä»¥ä¸‹ï¼‰
const isOldBrowser = !CSS.supports("selector(:has(*))");

// ç¦ç”¨æ¬¢è¿å¼¹çª—ï¼Œé¿å…é®æŒ¡ fallback æç¤º
if (isOldBrowser && config.readme) {
  config.readme.start = false;
}

/* ---------- ä¼˜å…ˆçº§çª—å£é¡ºåºä¿®æ­£ï¼šå­˜åœ¨urlPathæ—¶noticeåŠemotionalä¹Ÿå§‹ç»ˆæ’åœ¨æœ€å ---------- */
{
  const orderFix = {};
  for (const k of ['notice', 'emotional01', 'emotional02', 'emotional03']) {
    if (config[k]) {
      orderFix[k] = config[k];   // 1ï¸âƒ£ å¤‡ä»½
      delete config[k];          // 2ï¸âƒ£ åˆ é™¤åŸä½ç½®
    }
  }
  Object.assign(config, orderFix); // 3ï¸âƒ£ é‡æ–°æ’å…¥åˆ°æœ«å°¾
}

/* ---------- æŠŠ ./foo/bar â†’ /foo/barï¼Œä¿æŒ http(s) ä¸åŠ¨ ---------- */
function absPath(p) {
  if (!p) return p;
  if (p.startsWith('/') || /^https?:\/\//.test(p)) return p;   // å·²ç»æ˜¯ç»å¯¹ / å¤–é“¾
  return '/' + p.replace(/^\.?\/+/, '');                       // å»æ‰ ./ æˆ– /
}

// âœ… è‡ªåŠ¨è·å– colorful.js æ‰€åœ¨ç›®å½•ï¼Œå¹¶æŒ‡å‘å¯¹åº”çš„ images ç›®å½•
const baseImagePath = (() => {
  const scripts = document.getElementsByTagName('script');
  for (let s of scripts) {
    if (s.src && s.src.includes('colorful.js')) {
      const url = new URL(s.src, location.href);
      url.pathname = url.pathname.replace(/\/[^/]+$/, '/../images/');
      return url.href;
    }
  }
  return '../images/';
})();

/* === æµè§ˆå™¨æ ‡é¢˜ / æè¿°åŒæ­¥ ============================= */
const pathHeadMap = {};                // urlPath âœ { title, desc }

function applyHead(path) {
  const info = pathHeadMap[path];
  if (!info) return;

  /* <title> */
  document.title = info.title || document.title;

  /* <meta name="description"> */
  let meta = document.querySelector('meta[name="description"]');
  if (!meta) {
    meta = document.createElement('meta');
    meta.setAttribute('name', 'description');
    document.head.appendChild(meta);
  }
  if (info.desc) meta.setAttribute('content', info.desc);
}
/* ====================================================== */

const htmlConfig = {
    readme: `<h1 style="line-height: 100%; margin-block-start: 0.5em; margin-block-end: 0.05em;">æ¬¢è¿æ¥åˆ°å°å†·å®˜æ–¹ç½‘ç«™</h1>
    <h2 style="line-height: 100%; margin-block-start: 0em; margin-block-end: 0em;">Welcome to Xiaoleng Official Website</h2>
    <p><img src="./images/logo.png" alt="logo"></p>
    <p>è¿™é‡Œæ˜¯æ¯å¤©éƒ½åœ¨è¿½é€æ˜Ÿå…‰æ¢¦æƒ³çš„ä½ æœ€å¯çˆ±çš„å°å†·<br>
    I am your cutest Xiaoleng, chasing the dreams of starlight every day.</p>
    <p>å’Œå°å†·ä¸€èµ·åœ¨èˆå°ä¸Šå®ç°é—ªé—ªå‘å…‰âœ¨çš„æ¢¦æƒ³<br>
    With Xiaoleng, achieve our sparkling dreams on stageâœ¨</p>
    <p>è®©æˆ‘ä»¬æ²‰æººäºè¿™åœºè¯ç‰©ğŸ’Šç”œè…»çš„æ¢¦ä¸­<br>
    Let's indulge in this sweet, ğŸ’Šdrug-filled dream.<br>
    ä¹Ÿè¯·æ¥äº†è§£ä½ æœ€å¯çˆ±çš„å°å¶åƒå°å†·<br>
    Also, come get to know Xiaoleng, your cutest idol.</p>
    <p>è¯·å¤šå¤šå…³æ³¨å°å†·å§~<br>
    Please pay more attention to Xiaoleng~</p>`,
	notice: `
    <p>è¯´èµ·æ¥â€¦ç½‘ç«™ä¸Šçš„å¾ˆå¤šåŠŸèƒ½ï¼Œåœ¨å¤§é™†ç½‘ç»œä¸‹æ˜¯æ‰“ä¸å¼€çš„ğŸ¥º<br>
	Btw... Many features on this site arenâ€™t available under mainland Chinaâ€™s network. ğŸ¥º</p>
    <p>è¦ä¸è¦è¯•è¯• âœ¨å¼€ä¸ªVPNâœ¨ æˆ–ç”¨å›½å¤–ç½‘ç»œï¼Œå°±å¯ä»¥å’Œå°å†·ä¸€èµ·ç©è¾£ï¼<br>
    Try using a VPN or a foreign networkâ€”   
	and everything will open up like magic! âœ¨</p>`,
	ddos: `
    <p>Xiaoleng Official Websiteæ­£åœ¨æ‰¿å—DDoS æ”»å‡»ã€‚ä¸ºäº†ç¡®ä¿æ ¸å¿ƒåŠŸèƒ½åœ¨çº¿ï¼Œæˆ‘ä»¬ä¸´æ—¶å…³é—­äº†éƒ¨åˆ†èµ„æºåŒ…æ‹¬CSSæ–‡ä»¶çš„åˆ†å‘<br>
	Xiaoleng Official Website is undergoing a DDoS attack. To keep core functions online, we have temporarily disabled delivery of some resources, including CSS files.</p>
    <p>å¦‚æœä½ ç»•è¿‡é¦–é¡µï¼Œç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥å­é¡µé¢ URLï¼Œå¯èƒ½ä¼šçœ‹åˆ°è„±ç¦»CSSçš„é¡µé¢â€”â€”å†…å®¹ä»å¯é˜…è¯»ï¼Œåªæ˜¯æš‚æ—¶æ²¡æœ‰æ ·å¼<br>
	If you bypass the homepage and type a sub-page URL directly in the browserâ€™s address bar, you might see a page without CSS â€” the content is still readable; it just has no styles for the moment.</p>
	<p>æ­¤æªæ–½ä»…æ˜¯ä¸´æ—¶é™è½½ï¼ŒXiaoleng Official Websiteä¹‹æ•°æ®åŠåŠŸèƒ½éƒ½ä¸ä¼šå—å½±å“<br>
    This is only a temporary load-shedding measure; the data and functions of Xiaoleng Official Website will not be affected.</p>`,
	event05: `
    <p>å°å†·6æœˆ20æ—¥åœ¨ä¸Šæµ·ACæ¼«å±•æœ‰æ¼”å‡ºï¼<br>
    Iâ€™ll perform at Shanghai AC on June 20!</p>
    <p>æ¥æ‰¾æˆ‘ç©å–µ~<br>
     Come and see me~</p>`,
	emotional01: `
    <p>è¦å–œæ¬¢å°å†·å–µ~<br>
     Please like me a lot, nya~</p>`,
	emotional02: `
    <p>æœ€å–œæ¬¢ä½ äº†ï¼<br>
     I like you the most!</p>`,
	emotional03: `
    <p>ä½ æ²¡æœ‰è¶…çº§è¶…çº§å–œæ¬¢å°å†·ï¼Œæ°”æ°”å–µ<br>
     You did not super super like me, Iâ€™m mad now</p>`,
}
const urlConfig = {'pasta.html': 'pasta.html'};
let windowId = 0;

const resolvePath = (key, action) => action.urlPath || ('/' + key);

function prepareDom() {
    const template = document.createElement('template');
    template.innerHTML = `
        <div class="arena">
            <div class="desktop"></div>
            <div class="bar">
                <div class="start"></div>
                <div class="taskbar"></div>
                <div class="status"></div>
                <div class="menu">
                    <div class="ribbon"></div>
                    <div class="list"></div>
                </div>
            </div>
        </div>`;
    
    const startLogo = 'START';
    for (let i = 0; i < startLogo.length; i++) {
        const span = document.createElement('span');
        span.textContent = startLogo[i];
        template.content.querySelector('.start').appendChild(span);
    }

    template.content.querySelector('.start').addEventListener('click', (ev) => {
        const startMenu = document.querySelector('.menu');
        if (!startMenu.style.display || startMenu.style.display == 'none') {
            startMenu.style.display = 'grid';
            document.querySelector('.start').classList.add('active');
        } else {
            startMenu.style.display = 'none';
            document.querySelector('.start').classList.remove('active');
        }
    }, false);

    document.body.appendChild(template.content);
}

function putWindowOnTop(window) {
    const allWindows = document.querySelectorAll('.window');
    for (const w of allWindows) {
        if (w.style.zIndex > window.style.zIndex) {
            w.style.zIndex--;
        }
    }
    window.style.zIndex = allWindows.length;
    const activeTask = document.querySelector('.bar>.taskbar>.task.active');
    if (activeTask) {
        activeTask.classList.remove('active');
    }
    document.getElementById(`t${window.id.slice(1)}`).classList.add('active');
	const path = window.dataset.urlPath || '/';
	history.pushState({}, '', path);
	applyHead(path);        // â† æ–°å¢ï¼šå…³é—­ / æœ€å°åŒ–ååŒæ­¥ head
}

function makeWindow(title, style) {
    const template = document.createElement('template');
    template.innerHTML = `
        <div class="window">
            <div class="header">
                <div class="title">${title}</div>
                <div class="button minimize"></div>
                <div class="button maximize"></div>
                <div class="button close"></div>
            </div>
            <div class="content"></div>
        </div>`;
    
    const divWindow = template.content.querySelector('.window');
    divWindow.id = `w${windowId}`;
    windowId++;
    for (const s of style) {
        divWindow.classList.add(s);
    }
    divWindow.style.zIndex = document.querySelectorAll('.window').length + 1;
    divWindow.addEventListener('mousedown', (ev) => { putWindowOnTop(divWindow); });

    const lastCoord = { x: 0, y: 0 };
    const divTitle = template.content.querySelector('.title');
    function dragFn(ev) {
        const x = Math.round(ev.clientX);
        const y = Math.round(ev.clientY);
        divWindow.style.left = `${divWindow.offsetLeft + x - lastCoord.x}px`;
        divWindow.style.top = `${divWindow.offsetTop + y - lastCoord.y}px`;
        lastCoord.x = x;
        lastCoord.y = y;
        divWindow.classList.add('dragging');
    }
    
    divTitle.addEventListener('pointerdown', (ev) => {
        if (divWindow.classList.contains('maximized')) { return; }
        lastCoord.x = Math.round(ev.clientX);
        lastCoord.y = Math.round(ev.clientY);
        divTitle.setPointerCapture(ev.pointerId);
        divTitle.addEventListener('pointermove', dragFn);
    });

    divTitle.addEventListener('pointerup', (ev) => {
        if (divWindow.classList.contains('maximized')) { return; }
        divWindow.classList.remove('dragging');
        divTitle.removeEventListener('pointermove', dragFn);
    });

    template.content.querySelector('.minimize').addEventListener('click', (ev) => {
        document.getElementById(`t${divWindow.id.slice(1)}`).classList.remove('active');
        divWindow.style.display = 'none';
		updatePathAfterChange(); 
    });

    function maximizeFn(ev) {
        if (divWindow.classList.contains('maximized')) {
            divWindow.classList.remove('maximized');
        } else {
            divWindow.classList.add('maximized');
        }
    }

    template.content.querySelector('.maximize').addEventListener('click', maximizeFn);
    divTitle.addEventListener('dblclick', maximizeFn);

    template.content.querySelector('.close').addEventListener('click', (ev) => {
        document.getElementById(`t${divWindow.id.slice(1)}`).remove();
        divWindow.remove();
		updatePathAfterChange(); 
    });

    return divWindow;
}

function createWindow(title, content, config, urlPath = '/') {
    const style = config && config.style ? config.style : [];
    const divWindow = makeWindow(title, style);
    if (content) {
        divWindow.children[1].appendChild(content);
    }
	divWindow.dataset.urlPath = urlPath;
    document.querySelector('.desktop').appendChild(divWindow);
    divWindow.style.left = `${Math.floor(0.5 * Math.random() * (document.querySelector('.arena').offsetWidth - divWindow.offsetWidth))}px`;
    divWindow.style.top = `${Math.floor(0.33 * Math.random() * (document.querySelector('.arena').offsetHeight - divWindow.offsetHeight))}px`;

    const divTask = document.createElement('div');
    divTask.id = `t${divWindow.id.slice(1)}`;
    divTask.classList.add('task');
    divTask.textContent = title;
    divTask.addEventListener('click', (ev) => {
        divWindow.style.display = 'grid';
        putWindowOnTop(divWindow);
    });
    document.querySelector('.taskbar').appendChild(divTask);
    putWindowOnTop(divWindow);
    return divWindow;
}

function execute(key, action, urlPath = resolvePath(key, action)) {
    let name = key;
	let windowTitle = action.title || action.name;
    if (action.name) {
        name = action.name;
    }
    const config = {};
    if (action.style) {
        config.style = action.style;
    }
    const handler = {
        text: () => { 
			createWindow(name, document.createTextNode(action.value), config, urlPath);
		},
        html: () => {
            const template = document.createElement('template');
            template.innerHTML = action.value;
            createWindow(windowTitle, template.content, config, urlPath);
        },
        okusuri: () => {
            let hash = action.hash;
            if (!hash) { hash = '#' + key; }
            const desc = action.desc ? action.desc : '';
            const template = document.createElement('template');
            template.innerHTML = `
                <div class="folder-meta"><span>${name}</span><span>${hash}</span></div>
                <div class="folder-desc">${desc}</div>
                <div class="folder"></div>`;
            for (const file in action.value) {
                action.value[file].hash = hash + '/' + file;
                template.content.querySelector('.folder').appendChild(makeIcon(file, action.value[file]));
            }
            createWindow(windowTitle, template.content, config, urlPath);
        },
		123: async () => {
		  const src = absPath(action.value);
		  const win = createWindow(windowTitle,
			  document.createTextNode('Loadingâ€¦'), config, urlPath);
		  try {
			const r = await fetch(src);
			win.querySelector('.content').innerHTML = await r.text();
		  } catch (e) {
			win.querySelector('.content').textContent = 'âš ï¸ Failed to load.';
			console.warn(e);
		  }
		},
		url: async () => {
		  const src = absPath(action.value);

		  // â‘  ç«‹åˆ»å»ºå£³ï¼Œå ä½å¹¶åˆ†é… z-index
		  const win = createWindow(windowTitle,
			  document.createTextNode('Loadingâ€¦'), config, urlPath);

		  // â‘¡ åå°æ‹‰å–å¹¶å¡«å……
		  try {
			const r = await fetch(src);
			win.querySelector('.content').innerHTML = await r.text();
		  } catch (e) {
			win.querySelector('.content').textContent = 'âš ï¸ Failed to load.';
			console.warn(e);
		  }
		},
        md: async () => {
            const response = htmlConfig[action.value];
            const template = document.createElement('template');
            template.innerHTML = response;
            createWindow(windowTitle, template.content, config, urlPath);
        },
		md2: async () => {
		  const win = createWindow(windowTitle,
			  document.createTextNode('Loadingâ€¦'), config, urlPath);
		  try {
			const r = await fetch(action.value);
			win.querySelector('.content').innerHTML = await r.text();
		  } catch (e) {
			win.querySelector('.content').textContent = 'âš ï¸ Failed to load.';
			console.warn(e);
		  }
		},
        folder: () => {
            let hash = action.hash;
            if (!hash) { hash = '#' + key; }
            const desc = action.desc ? action.desc : '';
            const template = document.createElement('template');
            template.innerHTML = `
                <div class="folder-meta"><span>${name}</span><span>${hash}</span></div>
                <div class="folder-desc">${desc}</div>
                <div class="folder"></div>`;
            for (const file in action.value) {
                action.value[file].hash = hash + '/' + file;
                template.content.querySelector('.folder').appendChild(makeIcon(file, action.value[file]));
            }
            createWindow(windowTitle, template.content, config, urlPath);
        },
        iframe: () => {
          /* â‘  å»ºå£³çª—å£å¹¶æ”¾å…¥æ–‡æœ¬å ä½ */
          const win = createWindow(
            windowTitle,
            document.createTextNode('Loadingâ€¦'),
            config,
            urlPath
          );

          const content   = win.querySelector('.content');
          const placeholder = content.firstChild;            // â€œLoadingâ€¦â€ è¿™è¡Œ

          /* â‘¡ åˆ›å»º iframeï¼Œå…ˆ display:none æŒ‚åˆ° DOM é‡Œè®©å®ƒå¼€å§‹åŠ è½½ */
          const iframe = document.createElement('iframe');
          iframe.src       = absPath(action.value);
          iframe.scrolling = 'no';
          iframe.style.border  = 'none';
          iframe.style.display = 'none';   // ç­‰ onload æ‰æ˜¾ç¤º
          content.appendChild(iframe);

          /* â‘¢ æˆåŠŸ â†’ æ›¿æ¢å ä½ï¼›å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯æ–‡æœ¬ */
          iframe.onload  = () => {
            placeholder.remove();
            iframe.style.display = 'block';
          };
          iframe.onerror = () => {
            placeholder.textContent = 'âš ï¸ Failed to load.';
            iframe.remove();
          };
        },
		js: () => {
		  const script = document.createElement('script');
		  script.src = absPath(`/js/${action.value}`);     // â†
		  const win = createWindow(windowTitle, null, config, urlPath);
		  window.root = win.children[1];
		  win.appendChild(script);
		},
    };
    if (!handler[action.type]) { return; }
    handler[action.type]();
	
	/* ------ æ–°å¢ï¼šè®°å½•å¹¶ç«‹åˆ»åº”ç”¨ head ä¿¡æ¯ ------ */
    pathHeadMap[urlPath] = {
        title: action.title || action.name || key,
        desc : action.desc  || ''          // è‹¥æ²¡æœ‰ desc å°±ç•™ç©º
    };
    applyHead(urlPath);
}

function createEntry(key, action) {
    console.log(key, action);
    let name = key;
    if (action.name) {
        name = action.name;
    }
    const divEntry = document.createElement('div');
    divEntry.classList.add('entry');
    divEntry.textContent = name;
    if (action.type) {
        divEntry.addEventListener('click', (ev) => { console.log(key, action); execute(key, action); });
    }
    document.querySelector('.list').appendChild(divEntry);
}

function makeIcon(key, action) {
    let name = key;
    if (action.name) {
        name = action.name;
    }
    let icon = 'text';
    if (action.icon) {
        icon = action.icon;
    } else if (!action.type) {
        icon = 'restrict';
    } else if (action.type == 'folder') {
        icon = 'folder';
    } else if (action.type == '123') {
        icon = '123';
    } else if (action.type == 'okusuri') {
        icon = 'okusuri';
    } else if (action.type == 'url') {
        icon = 'url';
    } else if (action.type == 'iframe') {
        icon = 'url';
    } else if (action.type == 'js') {
        icon = 'exe';
	}
    const template = document.createElement('template');

	template.innerHTML = `
    <div class="iconwrap">
        <div class="icon">
            <img src="${baseImagePath}${icon}.png" alt="${icon}">
            <div class="tag">${name}</div>
        </div>
    </div>`;

	// åå¤„ç†ï¼šæ·»åŠ å¿«æ·æ–¹å¼ç®­å¤´
	const iconEl = template.content.querySelector('.icon');
	const imgEl = iconEl.querySelector('img');

	// åŒ…è£… img æˆä¸€ä¸ªå¯å®šä½å®¹å™¨
	const wrapper = document.createElement('div');
	wrapper.style.position = 'relative';
	wrapper.style.display = 'inline-block';
	wrapper.appendChild(imgEl); // æŠŠ img ç§»è¿›å»

	// æ·»åŠ ç®­å¤´
	if (action && action.external) {
		const arrow = document.createElement('img');
		arrow.src = './images/externel.png';
		arrow.alt = 'external';
		arrow.className = 'shortcut-arrow';
		wrapper.appendChild(arrow);
	}

	// æ’å›åŸæ¥ä½ç½®
	iconEl.insertBefore(wrapper, iconEl.firstChild);


    if (action.type) {
        template.content.querySelector('.icon').addEventListener('click', (ev) => { execute(key, action, resolvePath(key, action)); });
    }
    return template.content;
}

//å–ä»£æ—§çš„ processConfig â€”â€” åªæ”¶é›†å¼¹çª—ï¼Œä¸ flush
function processConfig(config,
                       startUp,
                       parentPath = '',
                       popupQueue = []) {        // â† æ”¶é›† notice / emotional
  for (const key in config) {
    const value = config[key];

    /* ---------- è‡ªåŠ¨è¡¥ urlPath ---------- */
    const fullPath = parentPath + '/' + key;
    if (!value.urlPath) value.urlPath = fullPath;

    /* ---------- é€’å½’å¤„ç†å­å±‚ ---------- */
    if (['folder', 'okusuri'].includes(value.type)) {
      processConfig(value.value, startUp, fullPath, popupQueue);
    }

    /* ---------- æ¡Œé¢å›¾æ ‡ / å¼€å§‹èœå• ---------- */
    if (value.link) {
      for (const link of value.link) {
        if (link === 'entry') createEntry(key, value);
        if (link === 'icon')  document.querySelector('.desktop')
                                       .appendChild(makeIcon(key, value));
      }
    }

    /* ---------- æ”¶é›†/å¼¹å‡ºçª—å£ ---------- */
    const isEventBlock = /^event\d+$/.test(key);
    const isNotice     = key === 'notice';
    const isEmotional  = /^emotional\d+$/.test(key);

    const mustFollowPage = (isEventBlock || isNotice || isEmotional) && !startUp;
    const targetPath     = mustFollowPage ? location.pathname : value.urlPath;

    if (isEventBlock && value.start) {
      /* eventXXï¼šç›´æ¥å¼¹å‡ºä½†å±‚çº§æœ€ä½ */
      execute(key, value, targetPath);

    } else if ((isNotice || isEmotional) && value.start) {
      /* notice / emotionalï¼šå…ˆæ”¶é›†ï¼Œç¨åå†å¼¹ï¼ˆä¿è¯æœ€é¡¶å±‚ï¼‰ */
      popupQueue.push([key, value, targetPath]);

    } else if (startUp && value.start) {
      /* å…¶å®ƒçª—å£åªåœ¨é¦–é¡µè‡ªåŠ¨å¼¹ä¸€æ¬¡ */
      execute(key, value, value.urlPath);
    }
  }
  return popupQueue;                                // â† æŠŠé˜Ÿåˆ—å¾€ä¸Šè¿”å›
}

async function loadDesktop () {
  const segments = location.pathname.split('/').filter(Boolean);

  /* 1ï¸âƒ£ å…ˆè·‘é…ç½®ï¼Œæ‹¿åˆ° popupQueueï¼ˆnotice / emotional ç­‰ï¼‰ */
  const popupQueue = processConfig(config, segments.length === 0, '');

  let queueFlushed = false;          // â† æ ‡è®°é˜Ÿåˆ—æ˜¯å¦å·²æå‰å¼¹å‡º

  /* 2ï¸âƒ£ å¦‚æœ URL æŒ‡å‘å­é¡µé¢ï¼Œä¼˜å…ˆæ‰“å¼€ï¼›è‹¥ä¸å­˜åœ¨åˆ™å‡º 404 */
  if (segments.length) {
    const result = findActionByPath(segments);

    if (result) {
      execute(result.key, result.action, location.pathname);

        } else {
      /* â€”â€” 404 æƒ…å†µï¼šå…ˆå¼¹ notice / emotionalï¼Œå†å»º 404 â€”â€” */
      for (const [k, v, p] of popupQueue) {
        execute(k, v, p);        // å¼¹çª—å…ˆå‡ºç° â†’ z-index æ¯” 404 ä½
      }
      queueFlushed = true;       // é˜»æ­¢åé¢å†æ¬¡ flush

      const html = await fetch('/404.html').then(r => r.text());
      const body = html.match(/<body[^>]*>([\s\S]*?)<\/body>/i)?.[1]
                || '<p>404 Not&nbsp;Found</p>';

      const tpl  = document.createElement('template');
      tpl.innerHTML = body;
      createWindow('404 Not Found', tpl.content,
                   { style: ['medium'] }, location.pathname); // 404 æœ€ååˆ›å»º â†’ æœ€é¡¶
    }
  }

  /* 3ï¸âƒ£ å…¶ä½™æƒ…å†µï¼ˆé¦–é¡µæˆ–æœ‰æ•ˆå­é¡µï¼‰å†ç»Ÿä¸€å¼¹ notice / emotional */
  if (!queueFlushed) {
    for (const [k, v, p] of popupQueue) {
      execute(k, v, p);
    }
  }
}

async function loadCounter(counterUrl) {
    const divCounter = document.createElement('div');
    divCounter.classList.add('counter');
    const response = await fetch(counterUrl);
    if (response.ok) {
        divCounter.textContent = await response.text();
    } else {
        divCounter.textContent = '*******';
    }
    document.querySelector('.status').appendChild(divCounter);
}

prepareDom();
loadDesktop();

// âœ… ç›‘å¬æµè§ˆå™¨å‰è¿›åé€€ï¼Œè§£æ pathname è‡ªåŠ¨è¿˜åŸçª—å£
window.addEventListener('popstate', () => {
    const segments = location.pathname.split('/').filter(Boolean);

    // å…³é—­æ‰€æœ‰çª—å£
    document.querySelectorAll('.window').forEach(win => win.remove());

    // å°è¯•æŸ¥æ‰¾åŒ¹é…çš„ config é¡¹
    const result = findActionByPath(segments);

    if (result) {
        execute(result.key, result.action, location.pathname);
    } else {
        // è‹¥æœªåŒ¹é…ä»»ä½•çª—å£é¡¹ï¼Œæ˜¾ç¤º GitHub Pages çš„ 404 é¡µé¢ï¼ˆåœ°å€æ ä¿æŒä¸åŠ¨ï¼‰
        fetch('/404.html')
            .then(res => res.text())
            .then(html => {
                const bodyStart = html.indexOf('<body');
                const bodyOpen = html.indexOf('>', bodyStart) + 1;
                const bodyEnd = html.indexOf('</body>');
                const bodyContent = html.slice(bodyOpen, bodyEnd).trim() || '<p>404 Not Found</p>';

                const template = document.createElement('template');
                template.innerHTML = bodyContent;

                createWindow('404 Not Found', template.content, { style: ['medium'] }, location.pathname);
            });
    }
});

function updatePathAfterChange () {
  /* åªä¿ç•™ä»ç„¶å¯è§çš„çª—å£ */
  const visibleWins = [ ...document.querySelectorAll('.window') ]
                        .filter(w => w.style.display !== 'none');

  /* æ¡Œé¢ç©ºäº† â†’ å›åˆ°æ ¹è·¯å¾„ */
  if (visibleWins.length === 0) {
    history.pushState({}, '', '/');
    return;
  }

  /* æ‰¾åˆ° z-index æœ€é«˜çš„é‚£ä¸ªçª—å£ */
  let top = visibleWins[0];
  for (const w of visibleWins) {
    if (+(w.style.zIndex || 0) > +top.style.zIndex) top = w;
  }

  /* æŠŠåœ°å€æ æ›´æ–°æˆå®ƒçš„ urlPath */
  const path = top.dataset.urlPath || '/';
  history.pushState({}, '', path);
  applyHead(path);      // â† æ–°å¢ï¼šåˆ‡æ¢çª—å£æ—¶åŒæ­¥ <title>/<meta>

}

// âœ… æ ¹æ® pathname è‡ªåŠ¨åŒ¹é… config ä¸­çš„ action é€’å½’åœ¨æ•´æ£µ config æ ‘é‡ŒæŸ¥æ‰¾ urlPath
// â€“ åªè¦æœ‰ä»»ä½• item çš„ urlPathï¼ˆå»æ‰å¼€å¤´ /ï¼‰ä¸ pathname å®Œå…¨ä¸€è‡´ï¼Œå°±è¿”å›å®ƒ
function findActionByPath(pathSegments, cfg = config) {
  const target = pathSegments.join('/');                // ä¾‹å¦‚ 'contact' æˆ– 'photos/DKFLBivUdQ'

  function dfs(tree) {
    for (const k in tree) {
      const item = tree[k];

      // ğŸ‘‰ æ˜¯å¦å‘½ä¸­
      if ((item.urlPath || '').replace(/^\/+/, '') === target) {
        return { key: k, action: item };
      }

      // ğŸ‘‰ ç»§ç»­å‘ä¸‹é€’å½’
      if (item.value) {
        const found = dfs(item.value);
        if (found) return found;
      }
    }
    return null;
  }

  return dfs(cfg);
}